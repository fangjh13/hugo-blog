<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Go | Fython&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="My Personal Blog Site">
<meta name="author" content="Fython">
<link rel="canonical" href="https://blog.fangjiahui.me/tags/go/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fe5e2aabdfff8eb553d92fe38c9df2462232b65718e9a34fc328f56fa92ba5fc.css" integrity="sha256-/l4qq9//jrVT2S/jjJ3yRiIytlcY6aNPwyj1b6krpfw=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.fangjiahui.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.fangjiahui.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.fangjiahui.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.fangjiahui.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.fangjiahui.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://blog.fangjiahui.me/tags/go/index.xml">
<link rel="alternate" hreflang="en" href="https://blog.fangjiahui.me/tags/go/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://blog.fangjiahui.me/tags/go/">
  <meta property="og:site_name" content="Fython&#39;s Blog">
  <meta property="og:title" content="Go">
  <meta property="og:description" content="My Personal Blog Site">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">
      <meta property="og:image" content="https://blog.fangjiahui.me/blog-cover-1.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog.fangjiahui.me/blog-cover-1.png">
<meta name="twitter:title" content="Go">
<meta name="twitter:description" content="My Personal Blog Site">

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.fangjiahui.me/" accesskey="h" title="Fython&#39;s Blog (Alt + H)">Fython&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.fangjiahui.me/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://blog.fangjiahui.me/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.fangjiahui.me/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://blog.fangjiahui.me/">Home</a>&nbsp;»&nbsp;<a href="https://blog.fangjiahui.me/tags/">Tags</a></div>
  <h1>
    Go
    <a href="/tags/go/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Go 服务性能分析 pprof 的使用
    </h2>
  </header>
  <div class="entry-content">
    <p>Go 服务性能分析 pprof 的使用 go 是主打性能的语言 所以官方集成了方便性能检测的工具 go tool pprof 方便好用，主要可以收集如下指标
profile : 程序 cpu 使用情况，按照一定频率去采集应用程序在 CPU 和寄存器上面的数据 heap : 程序 heap 内存使用情况，和调用关系 goroutine : 程序内 goroutine 启动数，各自的调用情况。 block : 报告导致阻塞的同步原语的情况 goroutines 不在运行状态的情况，可以用来分析和查找死锁等性能瓶颈。默认情况下未启用，需要手动调用runtime.SetBlockProfileRate启用。 mutex: 报告锁竞争。默认情况下未启用，需要手动调用runtime.SetMutexProfileFraction启用。 集成到服务 服务应用 常驻的服务型应用要使用 pprof 首先得在服务启动入口导入包
import _ &#34;net/http/pprof&#34; ··· go func() { log.Println(http.ListenAndServe(&#34;localhost:6060&#34;, nil)) }() 然后浏览器访问http://localhost:6060/debug/pprof/，显示如下页面
如上如果服务是 http 服务且使用的是 http.DefaultServeMux 不需要做任何路由注册默认会注册相关路由，初始化调用了init 函数会自动注册，路径为 /debug/pprof/，显示上图，能大概看个当前 goroutine 数目、堆分配情况、锁的情况，具体分析还是要使用下文的 go tool pprof 工具。
如果使用的是自定义的 ServeMux 或 Handler 需要我们自己手动注册需要的路由，比如使用 echo 框架的时候
func RegisterRoutes(engine *echo.Echo) { router := engine.Group(&#34;&#34;) ...... // 按需注册 router.GET(&#34;/debug/pprof&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) router.GET(&#34;/debug/pprof/allocs&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) router.GET(&#34;/debug/pprof/block&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) router.GET(&#34;/debug/pprof/goroutine&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) router.GET(&#34;/debug/pprof/heap&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) router.GET(&#34;/debug/pprof/mutex&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) router.GET(&#34;/debug/pprof/cmdline&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Cmdline))) router.GET(&#34;/debug/pprof/profile&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Profile))) router.GET(&#34;/debug/pprof/symbol&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Symbol))) router.POST(&#34;/debug/pprof/symbol&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Symbol))) router.GET(&#34;/debug/pprof/trace&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Trace))) router.GET(&#34;/debug/pprof/threadcreate&#34;, echo.WrapHandler(http.HandlerFunc(pprof.Index))) } 如果使用的是 gin 框架，可以使用官方提供的 middleware
...</p>
  </div>
  <footer class="entry-footer"><span title='2022-12-16 10:51:46 +0800 +0800'>December 16, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1082 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to Go 服务性能分析 pprof 的使用" href="https://blog.fangjiahui.me/posts/2022-12-16-go-tool-pprof-tutorial/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Go 中的类型和比较
    </h2>
  </header>
  <div class="entry-content">
    <p>Go 中的类型和比较 go 是一个强类型的语言，map 中要求键(key)必须是可比较的(comparable)，什么是可比较呢？就是能用操作符 == 的类型， 我们知道必须两个类型一致才能比较，否则编译器会报 invalid operation: a == c (mismatched types...) 的错误，准确的说基本类型（int8,float32,string）符合上面的原则，但 golang 中又有复合类型就不一样，先来看 go 中的类型
1. 基本类型 (Basic Types)
数字类型：
int8, uint8 (byte), int16, uint16, int32 (rune), uint32, int64, uint64, int, uint, uintptr.
float32, float64.
complex64, complex128.
布尔类型：
bool
字符串类型：
string
2. 复合类型 (Basic Types)
结构体(struct)类型
函数：go 中函数是一等公民，也是一种类型
数组(array)：包括长度和类型，不同长度的相同类型不属于同一类型
切片(slice)：切片有动态的长度和容量是一种引用类型
字典(map)：底层是哈希表也是一种引用类型
指针类型(pointer)
管道(channel)
接口类型(interface)
类型重定义(Type Definitions)和类型别名(Type Alias Declarations) 讲完了类型再来看看用户可以创建自己的类型（类型重定义）和创建别名，先看类型定义
// Define a solo new type. // type NewTypeName SourceType type MyInt int type Num int 上面定义了 MyInt , Num 两个类型，虽然他们的源类型都是 int 但他们是不同的类型，所以他们是不可以比较的，但可以通过转换成相同类型的再比较如
...</p>
  </div>
  <footer class="entry-footer"><span title='2022-05-29 13:53:54 +0800 +0800'>May 29, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;730 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to Go 中的类型和比较" href="https://blog.fangjiahui.me/posts/2022-05-29-go-types-and-comparisons/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent"> Go 中的 Arrays 和 Slices
    </h2>
  </header>
  <div class="entry-content">
    <p>Golang 中的 Arrays 和 Slices 在 go 语言中，我们经常使用Slices类型因为它的方便和灵活，它和另一个Arrays类型有着密切的关系，Slices 是建立在 Arrays 的基础上的，搞明白它们的原理能使我们更加的轻松的使用它们
Arrays Arrays 和别的语言(C、Java)的类型一样，有固定的长度，在内存里是一块连续的空间，用以存储相同类型的 types。用如下方式申明
var array [5]int 像[size]T在 go 中申明array，size 是 type 的一部分 如上面的[5]int代表 5 个 int 元素的 Arrays，和另一个如[10]int是不同的类型，Arrays 有确定的长度。并且申明之后带默认值(各类型的零值)。也可以使用[...]符号省略 size 申明，编译器自动计算 如array := [...]int{1, 2, 3, 4, 5} 变量array引用的是整个 Array 而不是 Array 的第一个元素，如果将一个数组另外赋值是将这个数组拷贝了一份，数组作为函数参数也是将整个数组拷贝一份，非引用数组的指针 Slices 就是因为 Arrays 比较难用，go 在此基础上建立了 Slices，它是可以动态调整长度(dynamically-sized)的描述 Arrays 一部分的 types，Slices 可以使用切片数组的方式得到
array := [5]int{1, 2, 3, 4, 5} // Arrays var slice = array[1:4] // same as `var slice []int = array[1:4]` fmt.Println(slice) // [2 3 4] fmt.Println(len(slice)) // 3 fmt.Println(cap(slice)) // 4 array[2] = 9 fmt.Println(slice) // [2 9 4] slice = slice[:4] fmt.Println(slice) // [2 9 4 5] fmt.Println(array) // [1 2 9 4 5] Slices 的底层指向的是 Arrays，它描述底层一部分的 Arrays，如果被引用的 array 变化了，引用它的所有 slice 都会随之变化 Slices 有长度(length)和容量(capacity)，分别通过len和cap获取，长度就是切片的长度，容量是从 slice 的第一个元素到底层引用的 Arrays 的末尾元素的个数，也就是这个 slices 最大能达到的长度，例如上面的 slice 从第二个元素2到引用底层 array 末尾的元素5所以 cap 等于 4，所以 slices 可以动态调整但不能大于它的容量 将整个 Arrays 转化成 Slices 可以忽略前后索引slice := array[:]。Slices 以[]T的形式申明
...</p>
  </div>
  <footer class="entry-footer"><span title='2021-04-08 03:17:59 +0800 +0800'>April 8, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;507 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to  Go 中的 Arrays 和 Slices" href="https://blog.fangjiahui.me/posts/2021-04-08-go-arrays-and-slices/"></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="https://blog.fangjiahui.me/">Fython&#39;s Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
