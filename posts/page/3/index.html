<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Posts | Fython&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="Posts - Fython&#39;s Blog">
<meta name="author" content="Fython">
<link rel="canonical" href="https://blog.fangjiahui.me/posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.73c5f38ae8d9aaab6402bebf0c9459d0d8b9c7b018822bddcff46721198a28d5.css" integrity="sha256-c8XziujZqqtkAr6/DJRZ0Ni5x7AYgivdz/RnIRmKKNU=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://blog.fangjiahui.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://blog.fangjiahui.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://blog.fangjiahui.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://blog.fangjiahui.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://blog.fangjiahui.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://blog.fangjiahui.me/posts/index.xml">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Posts" />
<meta property="og:description" content="My Personal Blog Site" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://blog.fangjiahui.me/posts/" /><meta property="og:image" content="https://blog.fangjiahui.me/blog-cover-1.png"/>

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.fangjiahui.me/blog-cover-1.png"/>

<meta name="twitter:title" content="Posts"/>
<meta name="twitter:description" content="My Personal Blog Site"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://blog.fangjiahui.me/posts/"
    }
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://blog.fangjiahui.me/" accesskey="h" title="Fython&#39;s Blog (Alt + H)">Fython&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://blog.fangjiahui.me/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="https://blog.fangjiahui.me/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://blog.fangjiahui.me/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://blog.fangjiahui.me/">Home</a></div>
  <h1>
    Posts
    <a href="/posts/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>使用kubeadm在虚拟机本地搭建Kubernetes集群
    </h2>
  </header>
  <div class="entry-content">
    <p>使用kubeadm在虚拟机本地搭建Kubernetes集群 本文使用ESXi创建3台ubuntu server 虚拟机搭建一个完整的Kubernetes集群，1台master主节点，2台worker做为工作节点。很多地址都是google的域名，安装下面一些环境可能需要科学上网，创建k8s集群需要如下包
docker – 容器运行环境 kubelet – Kubernets节点代理 kubeadm – 部署多节点Kubernetes集群的工具 kubectl – 用于和Kubernetes交互的命令行工具 会创建如下3台机器
主机名 IP地址 角色 master.k8s 10.0.0.175 主节点 node1.k8s 10.0.0.176 工作节点1 node2.k8s 10.0.0.177 工作节点2 记一下安装时最新的版本号
ubuntu server 20.04.1 kernel version 5.4.0 kubernetes v1.20.0 docker-ce 19.03.14 创建虚拟机配置网址和安装docker 首先在ESXi控制台创建一台ubuntu server虚拟机，配置建议2CPU、2G RAM、20G硬盘，主机名为master.k8s开机更新到最新版本后重启安装docker，切换到root用户，以下所有操作都用root用户
修改主机名
# set hostname hostnamectl set-hostname master.k8s 然后修改/etc/hosts域名解析并添加之后两台的ip地址，如下
10.0.0.175 master.k8s 10.0.0.176 node1.k8s 10.0.0.177 node2.k8s 配置主节点的网络修改/etc/netplan/00-installer-config.yaml如下，我这网卡是ens160
network: version: 2 renderer: networkd ethernets: ens160: # change your&#39;s dhcp4: no addresses: [10....</p>
  </div>
  <footer class="entry-footer"><span title='2020-12-23 13:16:29 +0800 +0800'>December 23, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;504 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to 使用kubeadm在虚拟机本地搭建Kubernetes集群" href="https://blog.fangjiahui.me/posts/2020-12-23-creating-a-kubernetes-cluster-with-kubeadm/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>正则表达式中的预查
    </h2>
  </header>
  <div class="entry-content">
    <p>正则表达式中的预查 有时候使用正则会用到非获取匹配，就是不进行存储供以后使用，也就是正则中的预查，预查分为正向预查(lookahead)和反向预查(lookbehind)。
正向预查
(?=pattern)正向肯定预查(Positive lookahead)。如Python(?=3)匹配Python后跟3的语句，如输入Python3但其中最后的3不算进结果，返回Python
(?!pattern)正向否定预查(Negative lookahead)。和上面的类似只是否定的，Python(?!3)匹配后面不带3的句子，输入Python2，也是返回Python
反向预查
(?&lt;=pattern)反向肯定预查(Positive lookbehind)。如(?&lt;=2)Python其实和上面也差不多反向就是向左匹配就是匹配Python前面是2的语句，如输入2Python，返回Python
(?&lt;!pattern)反向否定预查(Negative lookbehind)。如(?&lt;!3)Python匹配Python前面不是3的输入，如输入2Python，返回Python
还有一个长的挺像的这里也记录下
(?:pattern) 匹配pattern但不获取匹配结果。 (?:t|b)oy只匹配boy或者toy，和toy|boy一样但更简洁，当然如果使用(t|b)oy就会多一个group</p>
  </div>
  <footer class="entry-footer"><span title='2020-10-27 10:04:12 +0800 +0800'>October 27, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;16 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to 正则表达式中的预查" href="https://blog.fangjiahui.me/posts/2020-10-27-regular-expression-lookarounds/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>Bash 快捷操作
    </h2>
  </header>
  <div class="entry-content">
    <p>Bash 快捷操作 GUN Bash 是现代操作系统一般都默认自带的 Shell，它兼容 sh 并提供了更多的 feature，如果我们常用命令行那么记住一些快捷键和 trick 能大大提高我们的工作效率，这篇文章就介绍下本人常用的快捷键和一些技巧。
Bash 默认的是 emacs 模式，这里的快捷键以默认的为准，可以使用set -o命令查看，使用set -o emacs设置。
移动光标 快捷键 描述 Ctrl &#43; a 移动光标到行首 Ctrl &#43; e 移动光标到行尾 Alt &#43; b 移动光标后退一个单词（词首） Alt &#43; f 移动光标前进一个单词（词首） Ctrl &#43; f 光标前进一个字母 Ctrl &#43; b 光标后退一个字母 Ctrl &#43; xx 当前位置与行首之间光标切换 一般配合Ctrl的是单字符移动，Alt是单词为边界。建议将键盘上的caps lock键改成Ctrl这样手指移动距离更短按起来也更加舒服方便。
剪切（删除）粘贴 快捷键 描述 Ctrl &#43; k 剪切从光标到行尾 Ctrl &#43; u 剪切从光标到行首 Ctrl &#43; w 从光标向前剪切一个单词 Alt &#43; Backspace 与 Ctrl &#43; w 类似，但分隔符是一些特殊字符 Alt &#43; d 从光标向后剪切一个单词 Ctrl &#43; d 删除光标下一个字母，如果没有字符存在，ctrl&#43;d 则会登出该会话 Ctrl &#43; h 删除光标前一个字母 Alt &#43; t swap(当前单词, 上一个单词) Ctrl &#43; t swap(当前字母, 上一个字母) Ctrl &#43; y 粘贴上一次剪切的文本，配合 Ctrl-u、Ctrl-k 效果极好 大小写转换 快捷键 描述 Alt &#43; c 大写当前字母，并移动光标到单词尾 Alt &#43; u 大写从当光标到单词尾 Alt &#43; l 小写从当光标到单词尾 历史命令 快捷键 描述 Ctrl &#43; r 向后搜索历史命令 Ctrl &#43; g 退出搜索 Ctrl &#43; p 历史中上一个命令，代替向上方向键 Ctrl &#43; n 历史中下一个命令，代替乡下方向键 Alt &#43; ....</p>
  </div>
  <footer class="entry-footer"><span title='2020-07-14 03:47:53 +0800 +0800'>July 14, 2020</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;459 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to Bash 快捷操作" href="https://blog.fangjiahui.me/posts/2020-07-14-bash-tip-and-tricks/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>UML 类图
    </h2>
  </header>
  <div class="entry-content">
    <p>UML 类图 统一建模语言（英语：Unified Modeling Language，缩写 UML）是非专利的第三代建模和规约语言。UML是一种开放的方法，用于说明、可视化、构建和编写一个正在开发的、面向对象的、软件密集系统的制品的开放方法。UML展现了一系列最佳工程实践，这些最佳实践在对大规模，复杂系统进行建模方面，特别是在软件架构层次已经被验证有效。
以上是维基百科上对UML的定义，它定义了很多的图，本文主要介绍类图，是属于结构性图形中的静态图，本文所有图是通过OmniGraffle画的。
结构性图形（Structure diagrams）强调的是系统式的建模：
静态图（static diagram） 类图 对象图 包图 实现图（implementation diagram） 组件图 部署图 剖面图 复合结构图 行为式图形（Behavior diagrams）强调系统模型中触发的事件：
活动图 状态图 用例图 交互性图形（Interaction diagrams），属于行为图形的子集合，强调系统模型中的资料流程：
通信图 交互概述图（UML 2.0） 时序图（UML 2.0） 时间图（UML 2.0） 定义 UML类图是描述类的内部结构（属性, 方法等）和类与类之间的关系（泛化, 实现，组合, 聚合，关联，依赖），是一种静态结构图。是在面向对象程序设计中建模的常用方法，不仅是系统编码和测试的重要模型，以图的形式展示还可以简化人们对系统的理解。
格式 一般是用三层矩形框表示，第一层表示类的名称，第二层表示的是字段和属性，第三层则是类的方法，如果某一层没有则可以省略。第一层中，如果是抽象类，名称需用斜体显示。
属性和方法前面的符号（&#43;、#、-等）代表可见性
Public(&#43;) Protected(#) Private(-) Package(~) 第二层属性的格式是
可见性 名称 : 类型 [= 默认值]
第三层方法的格式是
可见性 名称(参数类型 参数, …) : 返回类型
类与类之间的关系 类图中类与类之间的关系主要由：继承、实现、依赖、关联、聚合、组合这六大类型。表示方式如下图：
泛化（generalization/extens） 泛化又称继承，是IS-A的关系，两个对象之间如果可以用IS-A来表示，就是继承关系：（..是..)
泛化关系用一条带空心箭头的实线表示；如下图表示（猫继承自动物）猫是（IS-A）动物
实现（realization/implements) 实现关系指的是一个class类实现interface接口（可以是多个）的功能，在Java中可以直接用关键字implements表示，在C&#43;&#43;中目标类可用抽象类表示
实现关系用一条带空心箭头的虚线表示；如下图自行车必须实现车这个抽象类 注意这个车类是斜体代表抽象类
各种关系的强弱顺序： 泛化 = 实现 &gt; 组合 &gt; 聚合 &gt; 关联 &gt; 依赖...</p>
  </div>
  <footer class="entry-footer"><span title='2020-07-09 06:10:47 +0800 +0800'>July 9, 2020</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;105 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to UML 类图" href="https://blog.fangjiahui.me/posts/2020-07-09-uml-class-diagram/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2>Flask项目中集成Celery
    </h2>
  </header>
  <div class="entry-content">
    <p>Flask项目中集成Celery Celery是一个简单高效的实时分布式任务队列系统，我们可以将一些耗时比较长或者计算密集的任务交给celery处理，它也支持定时任务类似于crontab。而web应用中可以将一些任务丢给celery异步处理，比如发邮件消息推送、模型推理等。简单的Flask应用集成Celery比简单，有官方文档可做参考，可较复杂的flask应用如使用了蓝图(blueprint)分了很多模块的怎么组织celery和各种任务就比较复杂官方也没有说明文档，一不小心就会陷入循环导入。下面就介绍一种celery集成方法。
官方文档demo中有一个make_celery的函数
def make_celery(app): celery = Celery( app.import_name, backend=app.config[&#39;CELERY_RESULT_BACKEND&#39;], broker=app.config[&#39;CELERY_BROKER_URL&#39;] ) celery.conf.update(app.config) class ContextTask(celery.Task): def __call__(self, *args, **kwargs): with app.app_context(): return self.run(*args, **kwargs) celery.Task = ContextTask return celery 这个函数主要用来创建Celery对象，并从flask上更新一些配置加入上下文环境，像文档上单文件是不会出问题的返回的celery对象直接在下面定义任务，然后集成到路由中。如果你flask app是使用app factories和蓝图(blueprint)，那在这里定义的task又怎么在路由中引用呢，这就会导致循环引用问题。
我们可以把make_celery拆开来，首先创建celery对象然后等flask app初始化完成后在更新配置，这就解决问题了，任务单独放在tasks.py文件中也便于管理和查看
先来看最终项目结构图，就是flask web项目加入了celery
flask-celery-demo ├── app │ ├── api │ │ ├── __init__.py │ │ └── views.py # 视图 │ ├── __init__.py │ └── tasks.py # celery任务 ├── config.py ├── requirements.txt ├── run.sh └── service.py # 应用入口 先解释下主要service....</p>
  </div>
  <footer class="entry-footer"><span title='2020-05-24 10:20:01 +0800 +0800'>May 24, 2020</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;238 words&nbsp;·&nbsp;Fython</footer>
  <a class="entry-link" aria-label="post link to Flask项目中集成Celery" href="https://blog.fangjiahui.me/posts/2020-05-24-flask-celery-integrated/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="https://blog.fangjiahui.me/posts/page/2/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="https://blog.fangjiahui.me/posts/page/4/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://blog.fangjiahui.me/">Fython&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
